"use strict";(self.webpackChunkbunni_docs=self.webpackChunkbunni_docs||[]).push([[9678],{3905:(e,t,n)=>{n.d(t,{Zo:()=>k,kt:()=>p});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var i=a.createContext({}),s=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},k=function(e){var t=s(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,k=c(e,["components","mdxType","originalType","parentName"]),d=s(n),p=l,m=d["".concat(i,".").concat(p)]||d[p]||u[p]||r;return n?a.createElement(m,o(o({ref:t},k),{},{components:n})):a.createElement(m,o({ref:t},k))}));function p(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=d;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:l,o[1]=c;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},683:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>s});var a=n(7462),l=(n(7294),n(3905));const r={title:"IERC20Lockable",hide_table_of_contents:!1,sidebar_position:6},o=void 0,c={unversionedId:"v2/technical/core/lockable",id:"v2/technical/core/lockable",title:"IERC20Lockable",description:"Introduction",source:"@site/docs/v2/technical/core/lockable.md",sourceDirName:"v2/technical/core",slug:"/v2/technical/core/lockable",permalink:"/docs/v2/technical/core/lockable",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"IERC20Lockable",hide_table_of_contents:!1,sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"AmAmm",permalink:"/docs/v2/technical/core/amamm"},next:{title:"BunniQuoter",permalink:"/docs/v2/technical/periphery/quoter"}},i={},s=[{value:"Introduction",id:"introduction",level:2},{value:"Key Components",id:"key-components",level:2},{value:"IERC20Lockable",id:"ierc20lockable",level:2},{value:"Functions",id:"functions",level:3},{value:"lock",id:"lock",level:4},{value:"unlock",id:"unlock",level:4},{value:"isLocked",id:"islocked",level:4},{value:"unlockerOf",id:"unlockerof",level:4},{value:"Events",id:"events",level:3},{value:"Errors",id:"errors",level:3},{value:"IERC20Unlocker",id:"ierc20unlocker",level:2},{value:"Functions",id:"functions-1",level:3},{value:"lockCallback",id:"lockcallback",level:4},{value:"lockedUserReceiveCallback",id:"lockeduserreceivecallback",level:4},{value:"Usage Example",id:"usage-example",level:2},{value:"Transfer-less Staking",id:"transfer-less-staking",level:3},{value:"Security Considerations",id:"security-considerations",level:2}],k={toc:s};function u(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"Bunni v2 introduces a lockable token system through the ",(0,l.kt)("inlineCode",{parentName:"p"},"IERC20Lockable")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"IERC20Unlocker"),' interfaces. This system enables advanced functionality like transfer-less staking while maintaining compatibility with existing ERC20 systems. The lockable token feature allows users to "lock" their tokens in place without transferring them to another contract, providing gas efficiency and improved user experience for certain DeFi applications.'),(0,l.kt)("p",null,"This feature is necessary for building staking reward contracts that don't affect referrer scores in Bunni's ",(0,l.kt)("a",{parentName:"p",href:"../../concepts/referral"},"referral system"),"."),(0,l.kt)("h2",{id:"key-components"},"Key Components"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"IERC20Lockable"),": An interface implemented by the token contract, allowing accounts to be locked and unlocked."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"IERC20Unlocker"),": An interface implemented by contracts that can unlock locked accounts and receive callbacks.")),(0,l.kt)("h2",{id:"ierc20lockable"},"IERC20Lockable"),(0,l.kt)("h3",{id:"functions"},"Functions"),(0,l.kt)("h4",{id:"lock"},"lock"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"function lock(IERC20Unlocker unlocker, bytes calldata data) external;\n")),(0,l.kt)("p",null,"Locks the caller's account, preventing any transfers from the account until it's unlocked."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"unlocker"),(0,l.kt)("td",{parentName:"tr",align:null},"IERC20Unlocker"),(0,l.kt)("td",{parentName:"tr",align:null},"The address that will be able to unlock the account")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"bytes"),(0,l.kt)("td",{parentName:"tr",align:null},"Additional data with no specified format")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Behavior:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Emits a ",(0,l.kt)("inlineCode",{parentName:"li"},"Lock")," event"),(0,l.kt)("li",{parentName:"ul"},"Calls ",(0,l.kt)("inlineCode",{parentName:"li"},"lockCallback")," on the ",(0,l.kt)("inlineCode",{parentName:"li"},"unlocker")," contract"),(0,l.kt)("li",{parentName:"ul"},"Reverts if the account is already locked (",(0,l.kt)("inlineCode",{parentName:"li"},"AlreadyLocked")," error)")))),(0,l.kt)("h4",{id:"unlock"},"unlock"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"function unlock(address account) external;\n")),(0,l.kt)("p",null,"Unlocks a previously locked account."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"account"),(0,l.kt)("td",{parentName:"tr",align:null},"address"),(0,l.kt)("td",{parentName:"tr",align:null},"The account to unlock")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Behavior:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Can only be called by the designated unlocker for the account"),(0,l.kt)("li",{parentName:"ul"},"Emits an ",(0,l.kt)("inlineCode",{parentName:"li"},"Unlock")," event"),(0,l.kt)("li",{parentName:"ul"},"Reverts if the account is not locked (",(0,l.kt)("inlineCode",{parentName:"li"},"AlreadyUnlocked")," error) or if called by an address that is not the unlocker (",(0,l.kt)("inlineCode",{parentName:"li"},"NotUnlocker")," error)")))),(0,l.kt)("h4",{id:"islocked"},"isLocked"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"function isLocked(address account) external view returns (bool);\n")),(0,l.kt)("p",null,"Checks if an account is locked."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"account"),(0,l.kt)("td",{parentName:"tr",align:null},"address"),(0,l.kt)("td",{parentName:"tr",align:null},"The account to check")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Returns:")," ",(0,l.kt)("inlineCode",{parentName:"p"},"bool")," - True if the account is locked, false otherwise"),(0,l.kt)("h4",{id:"unlockerof"},"unlockerOf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"function unlockerOf(address account) external view returns (IERC20Unlocker unlocker);\n")),(0,l.kt)("p",null,"Returns the unlocker of an account."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"account"),(0,l.kt)("td",{parentName:"tr",align:null},"address"),(0,l.kt)("td",{parentName:"tr",align:null},"The account whose unlocker is to be returned")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Returns:")," ",(0,l.kt)("inlineCode",{parentName:"p"},"IERC20Unlocker")," - The unlocker of the account"),(0,l.kt)("h3",{id:"events"},"Events"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"event Lock(address indexed account, IERC20Unlocker indexed unlocker);\nevent Unlock(address indexed account, IERC20Unlocker indexed unlocker);\n")),(0,l.kt)("h3",{id:"errors"},"Errors"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"error AlreadyLocked();\nerror AlreadyUnlocked();\nerror NotUnlocker();\nerror AccountLocked();\n")),(0,l.kt)("h2",{id:"ierc20unlocker"},"IERC20Unlocker"),(0,l.kt)("h3",{id:"functions-1"},"Functions"),(0,l.kt)("h4",{id:"lockcallback"},"lockCallback"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"function lockCallback(address account, uint256 balance, bytes calldata data) external;\n")),(0,l.kt)("p",null,"Called when an account calls ",(0,l.kt)("inlineCode",{parentName:"p"},"IERC20Lockable.lock()")," and specifies this contract as the unlocker."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"account"),(0,l.kt)("td",{parentName:"tr",align:null},"address"),(0,l.kt)("td",{parentName:"tr",align:null},"The account that called ",(0,l.kt)("inlineCode",{parentName:"td"},"IERC20Lockable.lock()"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"balance"),(0,l.kt)("td",{parentName:"tr",align:null},"uint256"),(0,l.kt)("td",{parentName:"tr",align:null},"The balance of the account after the lock")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"bytes"),(0,l.kt)("td",{parentName:"tr",align:null},"The data passed to ",(0,l.kt)("inlineCode",{parentName:"td"},"IERC20Lockable.lock()"))))),(0,l.kt)("h4",{id:"lockeduserreceivecallback"},"lockedUserReceiveCallback"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},"function lockedUserReceiveCallback(address account, uint256 receiveAmount) external;\n")),(0,l.kt)("p",null,"Called when a locked account with this contract as the unlocker receives tokens."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"account"),(0,l.kt)("td",{parentName:"tr",align:null},"address"),(0,l.kt)("td",{parentName:"tr",align:null},"The account that received tokens")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"receiveAmount"),(0,l.kt)("td",{parentName:"tr",align:null},"uint256"),(0,l.kt)("td",{parentName:"tr",align:null},"The amount of tokens received")))),(0,l.kt)("h2",{id:"usage-example"},"Usage Example"),(0,l.kt)("h3",{id:"transfer-less-staking"},"Transfer-less Staking"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Implement a staking contract that implements ",(0,l.kt)("inlineCode",{parentName:"li"},"IERC20Unlocker"),":")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},'contract StakingContract is IERC20Unlocker {\n    IERC20Lockable public immutable stakingToken;\n    mapping(address account => uint256) public stakedBalance;\n\n    constructor(IERC20Lockable _stakingToken) {\n        stakingToken = _stakingToken;\n    }\n\n    function lockCallback(address account, uint256 balance, bytes calldata data) external override {\n        require(msg.sender == address(stakingToken), "Only staking token");\n\n        // Staking logic here\n        stakedBalance[account] = balance;\n    }\n\n    function unstake() external {\n        // Unstaking logic here\n        require(stakedBalance[msg.sender] != 0, "Not staker");\n        stakedBalance[msg.sender] = 0;\n\n        // Unlock tokens\n        stakingToken.unlock(msg.sender);\n    }\n\n    function lockedUserReceiveCallback(address account, uint256 receiveAmount) external override {\n        // Handle additional tokens received by the staker\n        stakedBalance[account] += receiveAmount;\n    }\n}\n')),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Users interact with the staking system:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-solidity"},'// User locks their tokens, specifying the staking contract as the unlocker\nstakingToken.lock(stakingContract, bytes(""));\n\n// User unstakes by calling the staking contract\nstakingContract.unstake();\n')),(0,l.kt)("p",null,"This approach allows users to stake tokens without actually transferring them, reducing gas costs and simplifying the user experience. It enables staking contracts compatible with Bunni's ",(0,l.kt)("a",{parentName:"p",href:"../../concepts/referral"},"referral system"),"."),(0,l.kt)("h2",{id:"security-considerations"},"Security Considerations"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Authorized Unlockers"),": Ensure that only trusted contracts can be set as unlockers. Malicious unlockers could potentially prevent users from accessing their tokens."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Unlocking Logic"),": Implement robust checks in the unlocking logic to prevent unauthorized token releases. For example, in a staking contract, ensure that users can only unlock if they have previously staked."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Locked Account Interactions"),": Consider how locked accounts should interact with other parts of your system. For example, should locked accounts be able to participate in governance?"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Callback Security"),": Implement proper access controls and validation in the ",(0,l.kt)("inlineCode",{parentName:"li"},"IERC20Unlocker")," callbacks to prevent potential exploits."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Gas Considerations"),": While locking can save gas compared to token transfers, be aware of the gas costs associated with locking and unlocking, especially in contracts that might handle many users.")))}u.isMDXComponent=!0}}]);